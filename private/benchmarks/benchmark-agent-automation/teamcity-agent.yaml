---
  - hosts: machines
    remote_user: neo
    environment:
      JAVA_HOME: /usr/lib/jvm/oracle-jdk-8
    tasks:
      - name: install teamcity agent as a service
        template:
          src: templates/etc/systemd/system/teamcity-agent.service
          dest: /etc/systemd/system/teamcity-agent.service
        become: yes
        notify: enabled teamcity agent service
    handlers:
      - name: enabled teamcity agent service
        systemd:
          name: teamcity-agent.service
          daemon_reload: true
          enabled: true
          state: restarted
        become: yes
